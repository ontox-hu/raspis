<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="raspis">
<title>Retrieve PubChem cid and synonyms for each ASPIS compound • raspis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieve PubChem cid and synonyms for each ASPIS compound">
<meta property="og:description" content="raspis">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">raspis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/aspis-chemcicals-cid-synonyms.html">Retrieve PubChem cid and synonyms for each ASPIS compound</a>
    <a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="aspis-chemcicals-cid-synonyms_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Retrieve PubChem cid and synonyms for each ASPIS compound</h1>
                        <h4 data-toc-skip class="author">Marc A.T. Teunis, Ph.D.</h4>
            
            <h4 data-toc-skip class="date">2022-03-20 13:52:42</h4>
      
      
      <div class="d-none name"><code>aspis-chemcicals-cid-synonyms.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This workflow describes how to retrieve information (here PubChem cid and synonyms) for a given compound inchi, using the NCBI Entrez PUG-REST API. This vignette was also used to create these datsets in the <code>{raspis}</code> package:</p>
<ol style="list-style-type: decimal">
<li>merged_source_cid_synonyms</li>
<li>merged_source_cid_synonyms_tidy</li>
<li>smiles_cid<br>
</li>
<li>smiles_cid_synonyms</li>
<li>smiles_cid_synonyms_tidy</li>
<li>smiles_cid_tidy<br>
</li>
<li>data_source</li>
</ol>
<p>See <code>?raspis::dataset_name</code> for more info</p>
</div>
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">raspis</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/webchem/" class="external-link">webchem</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>
<span class="co"># install.packages("googlesheets4")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org" class="external-link">googlesheets4</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<ul>
<li><a href="https://cran.r-project.org/web/packages/rentrez/vignettes/rentrez_tutorial.html#finding-cross-references-entrez_link" class="external-link"><code>{rentrez}</code></a></li>
<li><a href="https://github.com/ropensci/webchem" class="external-link"><code>{webchem}</code></a></li>
</ul>
</div>
<div class="section level2">
<h2 id="list-of-chemicals">List of chemicals<a class="anchor" aria-label="anchor" href="#list-of-chemicals"></a>
</h2>
<p>Here we load the Googlesheet file containing compound info from the ASPIS project cluster for which we will build the query and perform the search. People who have access to the file and have the url to the file, can reproduce the results obtained in this demo.</p>
<p>see for workflow on how to use R to connect to Googlesheets: <a href="https://www.r-bloggers.com/2021/12/how-to-connect-r-to-google-sheets-using-googlesheets4/" class="external-link uri">https://www.r-bloggers.com/2021/12/how-to-connect-r-to-google-sheets-using-googlesheets4/</a></p>
<p>To initiate the authentication for your Google account run <code><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth.html" class="external-link">gs4_auth()</a></code> in the Console. You are presented with the option to select an eaxisting google account or to add a new one. You may choose to link the current session to an already cached token (press enter after selecting the apporpriate Google account), or choose ‘0’ to obtain a new token.</p>
<p>The Googlesheet we are trying to access here is in ‘everybody who has the link has access’ mode. So we do not need to authenticate. We can use <code><a href="https://googlesheets4.tidyverse.org/reference/gs4_deauth.html" class="external-link">gs4_deauth()</a></code> here, which in this case is safer to use.</p>
<p>The url to the sheet is stored as a cached value, to not show it here in the code. We use the RStudio API to achieve this.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="va">url_sheet</span><span class="op">)</span>
<span class="va">data_source</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 790 × 12</span></span>
<span class="co">##    `Compound Name`       IUPAC Inchi SMILES `CAS Number` DTXSID `Project ID (R…`</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> diclofenac            2-[2… InCh… O=C(O… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0000          </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> midazolam             8-ch… InCh… Cc1nc… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0001          </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> tolbutamide           1-bu… InCh… CCCCN… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0003          </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> haloperidol           4-[4… InCh… O=C(C… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0004          </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> cyclosporine A        (3S,… InCh… C/C=C… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0005          </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> propanolol            1-na… InCh… CC(C)… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0006          </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> 1,2-Benzisothiazolin… 1,2-… InCh… O=c1[… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0007          </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> 1,4‐Phenylenediamine  2,6-… InCh… Nc1cc… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0008          </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> 2,5-Diaminotoluene s… 2-me… InCh… OS(O)… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0009          </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> 2‑Methylisothiazolin… 2-me… InCh… Cn1sc… <span style="color: #949494;">&lt;chr [1]&gt;</span>    DTXSI… RH0010          </span>
<span class="co">## <span style="color: #949494;"># … with 780 more rows, and 5 more variables: `Project ID (ONTOX)` &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   `Project ID (PrecisionTox)` &lt;lgl&gt;, `Used in RISK-HUNT3R` &lt;lgl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   `Used in ONTOX` &lt;lgl&gt;, `Used in PrecisionTox` &lt;lgl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#usethis::use_data(data_source)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="clean-and-select-data">Clean and select data<a class="anchor" aria-label="anchor" href="#clean-and-select-data"></a>
</h2>
<p>Let’s clean up and reduce the amount of data. Steps to take:</p>
<ul>
<li>Clean up variable names to make them unix-safe</li>
<li>The file is not tidy, the columns “Project ID (RISK-HUNT3R)”, “Project ID (ONTOX)”, “Project ID (PrecisionTox)”, “Used in RISK-HUNT3R”, “Used in ONTOX”, “Used in PrecisionTox” contain variables (<code>project_id</code> &amp; <code>used_in_project</code>), that are spread over multiple columns. Here we will tidy them into 2 columns: <code>project_id</code> and <code>used_in_project</code>, using the <code><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite()</a></code> function from the <a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a> package.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_source</span> <span class="op">&lt;-</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "compound_name"            "iupac"                   </span>
<span class="co">##  [3] "inchi"                    "smiles"                  </span>
<span class="co">##  [5] "cas_number"               "dtxsid"                  </span>
<span class="co">##  [7] "project_id_risk_hunt3r"   "project_id_ontox"        </span>
<span class="co">##  [9] "project_id_precision_tox" "used_in_risk_hunt3r"     </span>
<span class="co">## [11] "used_in_ontox"            "used_in_precision_tox"</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_source</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    project_id_risk_hunt3r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">project_id_risk_hunt3r</span><span class="op">)</span>, 
      <span class="st">""</span>, 
      <span class="va">project_id_risk_hunt3r</span><span class="op">)</span>
  <span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    project_id_ontox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">project_id_ontox</span><span class="op">)</span>, 
      <span class="st">""</span>, 
      <span class="va">project_id_ontox</span><span class="op">)</span>
  <span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    project_id_precision_tox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">project_id_precision_tox</span><span class="op">)</span>, 
      <span class="st">""</span>, 
      <span class="va">project_id_precision_tox</span><span class="op">)</span>
  <span class="op">)</span> |&gt;
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span>
    col <span class="op">=</span> <span class="st">"project_id"</span>, 
    <span class="va">project_id_risk_hunt3r</span><span class="op">:</span> <span class="va">project_id_precision_tox</span>,
    sep <span class="op">=</span> <span class="st">"&lt;&gt;"</span> <span class="co">## add a token to be able to recognize the ids per project</span>
  <span class="op">)</span> |&gt; 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span>
    col <span class="op">=</span> <span class="st">"used_in_project"</span>, 
    <span class="va">used_in_risk_hunt3r</span><span class="op">:</span><span class="va">used_in_precision_tox</span>,
    sep <span class="op">=</span> <span class="st">"&lt;&gt;"</span> <span class="co">## add a token to be able to recognize the values per project</span>
    <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data_source_tidy</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="some-checks-on-duplicates">Some checks on duplicates<a class="anchor" aria-label="anchor" href="#some-checks-on-duplicates"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_source_tidy</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">smiles</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">aspis_duplicated_smiles</span>
<span class="va">aspis_duplicated_smiles</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 26 × 2</span></span>
<span class="co">##    smiles                                                                      n</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">"</span>C(CN)C(O)(P(=O)(O)O)P(=O)(O)O<span style="color: #949494;">"</span>                                             2</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">"</span>C(CO)O<span style="color: #949494;">"</span>                                                                    2</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">"</span>C[C@@H]1[C@H]2[C@@H]([C@H]3[C@@H](C(=O)C(=C([C@]3(C(=O)C2=C(C4=C1C=CC…     2</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">"</span>C[C@@H]1C[C@@H]([C@@H]2[C@H](C[C@H]([C@@](O2)(C(=O)C(=O)N3CCCC[C@H]3C…     2</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">"</span>C[C@@H]1C[C@H]2[C@@H]3CCC4=CC(=O)C=C[C@@]4([C@]3([C@H](C[C@@]2([C@]1(…     2</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">"</span>C[C@H](CS)C(=O)N1CCC[C@H]1C(=O)O<span style="color: #949494;">"</span>                                          2</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">"</span>C=CC(=O)N<span style="color: #949494;">"</span>                                                                 2</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">"</span>C1=CC=C(C=C1)C2=CC(=O)C3=C(O2)C=CC4=CC=CC=C43<span style="color: #949494;">"</span>                             2</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">"</span>C1C2=CN=C(N2C3=C(C=C(C=C3)Cl)C(=N1)C4=CC=CC=C4F)CO[C@H]5[C@@H]([C@H](…     2</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">"</span>C1CCC(C1)(C(=O)O)N<span style="color: #949494;">"</span>                                                        2</span>
<span class="co">## <span style="color: #949494;"># … with 16 more rows</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#usethis::use_data(aspis_duplicated_smiles)</span></code></pre></div>
<p>So there are 26 rows that have the same value for <code>inchi</code>.</p>
</div>
<div class="section level2">
<h2 id="can-we-see-which-chemicals-are-selected-in-two-or-more-projects">Can we see which chemicals are selected in two or more projects<a class="anchor" aria-label="anchor" href="#can-we-see-which-chemicals-are-selected-in-two-or-more-projects"></a>
</h2>
<p>We know from inspecting the data that the value “RH0106&lt;&gt;CMS-7713&lt;&gt;” in the <code>project_id</code> indicates that this compound is selected in both RISKHUNT3R and ONTOX. Let’s see which inchi belongs to this compound.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_source_tidy</span> |&gt;
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span>
    <span class="va">project_id</span> <span class="op">==</span> <span class="st">"RH0106&lt;&gt;CMS-7713&lt;&gt;"</span>
  <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">x</span>

<span class="va">x</span><span class="op">$</span><span class="va">smiles</span></code></pre></div>
<pre><code><span class="co">## [1] "C[C@@H]1[C@H]2[C@@H]([C@H]3[C@@H](C(=O)C(=C([C@]3(C(=O)C2=C(C4=C1C=CC=C4O)O)O)O)C(=O)N)N(C)C)O"</span></code></pre>
<p>Is this one of the duplicates?</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aspis_duplicated_smiles</span> |&gt;
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span>
    <span class="va">smiles</span> <span class="op">==</span> <span class="va">x</span><span class="op">$</span><span class="va">smiles</span>
  <span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span>
<span class="co">##   smiles                                                                       n</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> C[C@@H]1[C@H]2[C@@H]([C@H]3[C@@H](C(=O)C(=C([C@]3(C(=O)C2=C(C4=C1C=CC=C…     2</span></code></pre>
<p>????</p>
</div>
<div class="section level2">
<h2 id="add-cid">Add CID<a class="anchor" aria-label="anchor" href="#add-cid"></a>
</h2>
<p>To start with a clean query to PubChem, I will continue with only the unique inchi values for each compound in the ASPIS chemical set.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_source_tidy</span><span class="op">$</span><span class="va">smiles</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">enframe</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"index"</span>, value <span class="op">=</span> <span class="st">"smiles"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">smiles_unique</span>
<span class="va">smiles_unique</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 764 × 2</span></span>
<span class="co">##    index smiles                                                                 </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                  </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1 O=C(O)Cc1ccccc1Nc1c(Cl)cccc1Cl                                         </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2 Cc1ncc2n1-c1ccc(Cl)cc1C(c1ccccc1F)=NC2                                 </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3 CCCCNC(=O)NS(=O)(=O)c1ccc(C)cc1                                        </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 O=C(CCCN1CCC(O)(c2ccc(Cl)cc2)CC1)c1ccc(F)cc1                           </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     5 C/C=C/C[C@@H](C)[C@@H](O)[C@H]1C(=O)N[C@@H](CC)C(=O)N(C)CC(=O)N(C)[C@@…</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     6 CC(C)NCC(O)COc1cccc2ccccc12                                            </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     7 O=c1[nH]sc2ccccc12                                                     </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     8 Nc1ccc(N)cc1                                                           </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     9 OS(O)(=O)=O.Cc1cc(N)ccc1N                                              </span>
<span class="co">## <span style="color: #BCBCBC;">10</span>    10 Cn1sccc1=O                                                             </span>
<span class="co">## <span style="color: #949494;"># … with 754 more rows</span></span></code></pre>
<p>CID is the PubChem id. We need this id for other things.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get all CID for all chemicals by name</span>
<span class="co">## wrap get_cid() in function with a pause, not to overburden the NCBI server.</span>
<span class="va">get_cid_with_pause</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">wait</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/webchem/reference/get_cid.html" class="external-link">get_cid</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
  <span class="fu">profvis</span><span class="fu">::</span><span class="fu">pause</span><span class="op">(</span><span class="va">wait</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="va">hold</span> <span class="op">=</span> <span class="fl">2</span>

<span class="va">smiles_cid</span> <span class="op">&lt;-</span> <span class="va">smiles_unique</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    cid <span class="op">=</span> <span class="fu">map</span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">smiles</span>,
    <span class="va">get_cid_with_pause</span>,
    verbose <span class="op">=</span> <span class="cn">TRUE</span>,
    from <span class="op">=</span> <span class="st">'smiles'</span>,
    wait <span class="op">=</span> <span class="va">hold</span><span class="op">)</span>
  <span class="op">)</span>
<span class="co">#usethis::use_data(smiles_cid)</span>

<span class="va">smiles_cid_tidy</span> <span class="op">&lt;-</span> <span class="va">smiles_cid</span> |&gt;
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">cid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">query</span><span class="op">)</span>

<span class="co">## store dataset in package</span>
<span class="co">#usethis::use_data(smiles_cid_tidy, overwrite = TRUE)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="check-cid-for-missingness-and-uniqueness">Check cid for missingness and uniqueness<a class="anchor" aria-label="anchor" href="#check-cid-for-missingness-and-uniqueness"></a>
</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## load datset from package</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"raspis"</span>, <span class="st">"smiles_cid_tidy"</span><span class="op">)</span>
<span class="co">## are there inchi values that did not match to any CID?</span>
<span class="va">smiles_cid_tidy</span><span class="op">$</span><span class="va">cid</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 62</span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">naniar</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html" class="external-link">vis_miss</a></span><span class="op">(</span><span class="va">smiles_cid_tidy</span><span class="op">)</span></code></pre></div>
<p><img src="aspis-chemcicals-cid-synonyms_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## is every cid matched to a unique cid?</span>
<span class="va">smiles_cid_tidy</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">smiles</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">x</span>
<span class="va">x</span><span class="op">$</span><span class="va">n</span></code></pre></div>
<pre><code><span class="co">## integer(0)</span></code></pre>
<p>From the code above we can conclude that:</p>
<ol style="list-style-type: decimal">
<li>There are missing cid. This means that for values of <code>inchi</code> a matching cid was not returned from the PubChem database. What this means for the project, remains to be seen.</li>
<li>Each value for <code>cid</code> has a matching unique value for <code>smiles</code>. This is to be expected as cid and smiles are both resolvable ids.</li>
</ol>
</div>
<div class="section level2">
<h2 id="enrich-compound-data-with-synonyms">Enrich compound data with synonyms<a class="anchor" aria-label="anchor" href="#enrich-compound-data-with-synonyms"></a>
</h2>
<p>No we add synonyms to each row that we have a cid for. To reduce the number of queries, we use only the complete records (that have an inchi and a cid). See <a href="https://pubchemdocs.ncbi.nlm.nih.gov/pug-rest" class="external-link">PUG-REST API PubChem</a> for all attributes that can be retrieved.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_synonyms_with_pause</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">wait</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/webchem/reference/pc_synonyms.html" class="external-link">pc_synonyms</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
  <span class="fu">profvis</span><span class="fu">::</span><span class="fu">pause</span><span class="op">(</span><span class="va">wait</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="va">hold</span> <span class="op">=</span> <span class="fl">2</span>

<span class="va">smiles_cid_synonyms</span> <span class="op">&lt;-</span> <span class="va">smiles_cid_tidy</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    synonyms <span class="op">=</span> <span class="fu">map</span><span class="op">(</span>
      <span class="va">cid</span>,
      <span class="va">get_synonyms_with_pause</span>,
      from <span class="op">=</span> <span class="st">"cid"</span>,
      wait <span class="op">=</span> <span class="va">hold</span>, 
      verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> 

<span class="co">#usethis::use_data(smiles_cid_synonyms)</span>

<span class="va">smiles_cid_synonyms_tidy</span> <span class="op">&lt;-</span> <span class="va">smiles_cid_synonyms</span> |&gt;
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">synonyms</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">synonyms</span><span class="op">)</span>
<span class="co">## write as dataset to package</span>
<span class="co">#usethis::use_data(smiles_cid_synonyms_tidy)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="result">Result<a class="anchor" aria-label="anchor" href="#result"></a>
</h2>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smiles_cid_synonyms_tidy</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 5 × 5</span></span>
<span class="co">##   index smiles                         cid   synonyms        synonyms_id</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="co">## <span style="color: #BCBCBC;">1</span>     1 O=C(O)Cc1ccccc1Nc1c(Cl)cccc1Cl 3033  diclofenac      3033       </span>
<span class="co">## <span style="color: #BCBCBC;">2</span>     1 O=C(O)Cc1ccccc1Nc1c(Cl)cccc1Cl 3033  15307-86-5      3033       </span>
<span class="co">## <span style="color: #BCBCBC;">3</span>     1 O=C(O)Cc1ccccc1Nc1c(Cl)cccc1Cl 3033  Diclofenac acid 3033       </span>
<span class="co">## <span style="color: #BCBCBC;">4</span>     1 O=C(O)Cc1ccccc1Nc1c(Cl)cccc1Cl 3033  dichlofenac     3033       </span>
<span class="co">## <span style="color: #BCBCBC;">5</span>     1 O=C(O)Cc1ccccc1Nc1c(Cl)cccc1Cl 3033  Voltaren        3033</span></code></pre>
</div>
<div class="section level2">
<h2 id="create-merged-dataset-with-source">Create merged dataset with source<a class="anchor" aria-label="anchor" href="#create-merged-dataset-with-source"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marc Teunis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
